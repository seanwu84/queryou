const userImage = document.querySelector(".nav-bar-user-image-outer-container");
const addQuestionButton = document.querySelector(".create-question-button");
const questionFormHolder = document.querySelector(".question-form");
const modal = document.querySelector(".modal-background");
const exitButton = document.querySelector(".question-form-exit-image");
const cancelButton = document.querySelector(".question-form-cancel-button");
const submitButton = document.querySelector(".question-form-submit-button");
const questionForm = document.querySelector("#question-form");

const updateIcon = (currentIcon, svgHtml) => {
  const svg = document.querySelector(`.${currentIcon}`);
  const container = document.querySelector(`.${currentIcon}-btn-container`)
  const text = document.querySelector(`.${currentIcon} + div`);
  svg.innerHTML = svgHtml;
  text.style.color = '#b92b27';
  container.classList.add('current-page');
}

const hideQuestionFormAndModal = (e) => {
  e.preventDefault();
  questionFormHolder.classList.add("hidden");
  modal.classList.add("hidden");
}

const showQuestionFormAndModal = (e) => {
  e.preventDefault();
  questionFormHolder.classList.remove("hidden");
  modal.classList.remove("hidden");
}

window.addEventListener('DOMContentLoaded', () => {
  const path = window.location.href;
  const currentRoute = path.split('8081')[1];
  if(currentRoute === '/') {
    updateIcon('home', `
      <svg width="24px" height="24px" viewBox="0 0 24 24"><g stroke="none" fill="#b92b27" fill-rule="nonzero"><path d="M2.4913634,2.04921404 C2.98092279,1.55513216 3.64670648,1.27576655 4.34511285,1.27256944 L21.6432503,1.27256944 C21.9884286,1.27256944 22.2682507,1.55239192 22.2682503,1.89757017 L22.2682226,20.0928469 C22.2714301,20.7904709 21.9965456,21.4606224 21.5043785,21.9550524 C21.0122114,22.4494823 20.3433278,22.7274379 19.6457031,22.7274306 L2.35674959,22.7274306 C2.01157134,22.7274306 1.73174919,22.4476081 1.73174959,22.1024298 L1.73177083,3.90562151 C1.72897519,3.21063504 2.00216491,2.54293169 2.4913634,2.04921404 Z M5.45178819,5.75945313 C5.13477579,5.75945313 4.87778646,6.01644246 4.87778646,6.33345486 C4.87778646,6.65046727 5.13477579,6.9074566 5.45178819,6.9074566 L11.5407986,6.9074566 C11.857811,6.9074566 12.1148003,6.65046727 12.1148003,6.33345486 C12.1148003,6.01644246 11.857811,5.75945313 11.5407986,5.75945313 L5.45178819,5.75945313 Z M5.45178819,9.60756076 C5.13477579,9.60756076 4.87778646,9.86455009 4.87778646,10.1815625 C4.87778646,10.4985749 5.13477579,10.7555642 5.45178819,10.7555642 L11.5407986,10.7555642 C11.857811,10.7555642 12.1148003,10.4985749 12.1148003,10.1815625 C12.1148003,9.86455009 11.857811,9.60756076 11.5407986,9.60756076 L5.45178819,9.60756076 Z M18.7686285,18.4425955 C19.0856409,18.4425955 19.3426302,18.1856062 19.3426302,17.8685938 C19.3426302,17.5515813 19.0856409,17.294592 18.7686285,17.294592 L5.45178819,17.294592 C5.13477579,17.294592 4.87778646,17.5515813 4.87778646,17.8685938 C4.87778646,18.1856062 5.13477579,18.4425955 5.45178819,18.4425955 L18.7686285,18.4425955 Z M18.7686285,14.5990799 C19.0856409,14.5990799 19.3426302,14.3420905 19.3426302,14.0250781 C19.3426302,13.7080657 19.0856409,13.4510764 18.7686285,13.4510764 L5.45178819,13.4510764 C5.13477579,13.4510764 4.87778646,13.7080657 4.87778646,14.0250781 C4.87778646,14.3420905 5.13477579,14.5990799 5.45178819,14.5990799 L18.7686285,14.5990799 Z M19.3472222,10.3927951 L19.3472222,5.90180556 C19.3472668,5.74715364 19.2849044,5.59902688 19.17426,5.49097576 C19.0636157,5.38292463 18.9140518,5.32409217 18.7594444,5.32780382 L14.2684549,5.32780382 C13.9514425,5.32780382 13.6944531,5.58479315 13.6944531,5.90180556 L13.6944531,10.3927951 C13.6944531,10.7098075 13.9514425,10.9667969 14.2684549,10.9667969 L18.7732205,10.9667969 C19.0902329,10.9667969 19.3472222,10.7098075 19.3472222,10.3927951 Z"></path></g></svg>`
    );
  }
  else if(currentRoute === '/queries') {
    updateIcon('queries', `
      <svg width="24px" height="24px" viewBox="0 0 24 24"><g stroke="none" fill="#b92b27" fill-rule="nonzero"><path d="M2.41264538,19.3337024 L4.65528055,21.5992062 L2.30714318,22.574687 C1.96393858,22.7172636 1.5701351,22.5546225 1.42755848,22.2114179 C1.35877313,22.0458406 1.3589108,21.859659 1.42794094,21.6941836 L1.42794094,21.6941836 L2.41264538,19.3337024 Z M21.5,9.875 C21.8137982,9.875 22.0735831,10.1062579 22.1182234,10.4076421 L22.125,10.5 L22.125,21.5 C22.125,21.8137982 21.8937421,22.0735831 21.5923579,22.1182234 L21.5,22.125 L10.5,22.125 C10.154822,22.125 9.875,21.845178 9.875,21.5 C9.875,21.1862018 10.1062579,20.9264169 10.4076421,20.8817766 L10.5,20.875 L20.875,20.875 L20.875,10.5 C20.875,10.1862018 21.1062579,9.92641686 21.4076421,9.8817766 L21.5,9.875 Z M17.9126877,2.18343678 C18.6099399,1.48618927 19.6262062,1.21388395 20.5786699,1.46909408 C21.5311344,1.72430444 22.2750948,2.46825931 22.5303074,3.42071908 C22.7855202,4.37317979 22.513211,5.38944321 21.8158837,6.08676581 L21.8158837,6.08676581 L7.56251865,20.3352888 C7.50247802,20.395309 7.43083895,20.4424681 7.35197178,20.4738891 L7.35197178,20.4738891 L6.16222778,20.9478871 C5.93155449,21.0397881 5.66835627,20.9864207 5.49169847,20.8119272 L5.49169847,20.8119272 L3.16909147,18.5177752 C2.9906625,18.3415322 2.93486442,18.0757004 3.0273698,17.8425883 L3.0273698,17.8425883 L3.5013708,16.6481133 C3.53285514,16.5687733 3.58025769,16.4967234 3.6406557,16.436406 L3.6406557,16.436406 Z M13.5,1.875 C13.845178,1.875 14.125,2.15482203 14.125,2.5 C14.125,2.81379815 13.8937421,3.07358314 13.5923579,3.1182234 L13.5,3.125 L3.124,3.125 L3.125,13.5 C3.125,13.8137982 2.89374212,14.0735831 2.59235792,14.1182234 L2.5,14.125 C2.18620185,14.125 1.92641686,13.8937421 1.8817766,13.5923579 L1.875,13.5 L1.875,2.5 C1.875,2.18620185 2.10625788,1.92641686 2.40764208,1.8817766 L2.5,1.875 L13.5,1.875 Z"></path></g></svg>
    `);
  }
  else if(currentRoute === '/topics') {
    updateIcon('topics', `
      <svg width="24px" height="24px" viewBox="0 0 24 24"><g stroke="none" fill="#b92b27" fill-rule="nonzero"><path d="M12,11.375 C14.2762055,11.375 16.125,13.1977519 16.125,15.450698 L16.125,15.450698 L16.125,22.5 C16.125,22.845178 15.845178,23.125 15.5,23.125 L15.5,23.125 L8.5,23.125 C8.15482203,23.125 7.875,22.845178 7.875,22.5 L7.875,22.5 L7.875,15.450698 C7.875,13.1977519 9.72379452,11.375 12,11.375 Z M5,9.375 C6.37559916,9.375 7.63833448,10.0460592 8.40280385,11.1463225 C8.58402451,11.4071445 8.54082068,11.7624068 8.30236898,11.972192 C8.28470781,11.9877299 8.25739981,12.0134056 8.22205992,12.0487421 L8.22205992,12.0487421 L8.09355953,12.1832571 C7.92253001,12.3693753 7.75057515,12.5851746 7.59034153,12.8263433 C7.1409469,13.5027302 6.875,14.2356156 6.875,14.995863 L6.875,14.995863 L6.875,22.5 C6.875,22.845178 6.59517797,23.125 6.25,23.125 L6.25,23.125 L1.5,23.125 C1.15482203,23.125 0.875,22.845178 0.875,22.5 L0.875,22.5 L0.875,13.450698 C0.875,11.1977519 2.72379452,9.375 5,9.375 Z M18.9996361,9.375 C21.2758415,9.375 23.1246361,11.1977519 23.1246361,13.450698 L23.1246361,22.5 C23.1246361,22.845178 22.844814,23.125 22.4996361,23.125 L17.7496361,23.125 C17.4044581,23.125 17.1246361,22.845178 17.1246361,22.5 L17.1246361,14.4958631 C17.1246361,13.754726 16.8734417,13.1391003 16.4497072,12.6305586 C16.1951081,12.3250035 15.9442078,12.1284839 15.7986319,12.0448045 C15.4811066,11.8622858 15.3878542,11.4470942 15.5968322,11.1463225 C16.3613016,10.0460592 17.6240369,9.375 18.9996361,9.375 Z M12,2.625 C13.0205123,2.625 13.9488855,3.01949413 14.6409411,3.6643038 C15.383777,4.31637846 15.875,5.20579853 15.875,6.125 L15.875,6.125 L15.875,6.75 C15.7378709,8.77392042 14.0559115,10.375 12,10.375 C9.94408848,10.375 8.26212913,8.77392042 8.13297405,6.75061335 L8.125,6.75 L8.125,6.125 C8.125,5.20579853 8.61622303,4.31637846 9.35884765,3.66415428 C10.0511145,3.01949413 10.9794877,2.625 12,2.625 Z M14.613202,6.7505079 L9.38679802,6.7505079 C9.51292504,8.08274798 10.634747,9.125 12,9.125 C13.365253,9.125 14.487075,8.08274798 14.613202,6.7505079 Z M19.1915548,0.625284171 C19.233493,0.624721283 19.2755151,0.624841261 19.3176064,0.625651391 L19.3497737,0.626323405 L19.3497737,0.626323405 L19.4315607,0.62952845 C19.4558853,0.630715721 19.4802286,0.632134433 19.5045877,0.633785981 L19.5524546,0.636928482 L19.6633443,0.647839291 C19.6743389,0.649041015 19.6853355,0.650290571 19.6963339,0.651588088 L19.5524546,0.636928482 C21.1782655,0.764490681 22.5502131,1.89632567 22.9844389,3.46826118 C23.0977152,3.87833132 23.1408518,4.29545442 23.1191266,4.70480317 L23.1169737,6.88117797 L23.1386876,7.06882726 L23.1636366,7.22043869 L23.176,7.28 L23.2348778,7.29191543 C23.6109274,7.38818605 23.8896413,7.84056171 23.6268314,8.23902716 L23.6268314,8.23902716 L23.5711001,8.31300757 C23.4810363,8.41876433 23.3371058,8.55687345 23.1421498,8.69385521 C22.2937818,9.28994336 21.2821702,9.27149975 20.4474812,8.25072209 C20.4333043,8.23338453 20.4191992,8.2157741 20.4051657,8.19788993 C19.28659,8.54839559 18.0432243,8.37814694 17.0433456,7.68576771 C16.7595636,7.48925913 16.6888146,7.09990671 16.8853231,6.81612473 C17.0818317,6.53234276 17.4711841,6.4615937 17.7549661,6.65810227 C18.5526484,7.21046791 19.5790932,7.27227792 20.4274498,6.84590857 C21.066481,6.39268349 21.2614465,5.51817868 20.8424065,4.79958569 C20.793182,4.70236723 20.6459709,4.53688166 20.4232423,4.34146901 C20.2632745,4.2011201 20.0712281,4.05046934 19.8544331,3.89363257 C19.5951828,3.70608224 19.3152872,3.5200814 19.0351507,3.34492002 L19.0351507,3.34492002 L18.993,3.318 L17.1183973,4.55468583 C16.8409455,4.73762111 16.4752286,4.66952355 16.2793241,4.41461272 L16.2793241,4.41461272 L16.2259051,4.3325993 L15.7739595,3.50945662 C15.7093788,3.4147915 15.6716823,3.30360429 15.6656917,3.18873261 L15.6653877,3.16852632 C15.6620064,3.07256798 15.6807216,2.97583104 15.7218098,2.88616162 C16.2328389,1.77090949 17.2203674,0.996979693 18.3541493,0.728753811 C18.3685346,0.726236201 18.3824733,0.723008194 18.3964351,0.719856467 C18.4462769,0.707792172 18.4967342,0.697496676 18.5474399,0.688203683 C18.5574159,0.687082564 18.5674063,0.685283255 18.5774071,0.683522779 C18.6937788,0.662448426 18.811519,0.647330621 18.9301938,0.637666184 C18.9505364,0.636372331 18.9704882,0.63488701 18.9904686,0.633555616 C19.0392473,0.630025919 19.0883717,0.627735216 19.1376209,0.626385249 C19.1410501,0.626462565 19.144727,0.626362841 19.1484047,0.626268338 Z M4.68663029,0.625479966 C4.71766366,0.624959882 4.74865856,0.624814825 4.77960913,0.625041867 C4.81386026,0.625338075 4.8481405,0.626041743 4.88234663,0.627196851 C4.9109956,0.628137059 4.93967335,0.629432423 4.96830229,0.63104524 C5.00793672,0.63328202 5.04700311,0.636073724 5.085952,0.639450474 C5.12011133,0.642446813 5.15488693,0.645945958 5.18957112,0.649911276 C5.21385668,0.652610516 5.2377702,0.655563871 5.26163223,0.658737325 C5.30285982,0.664337403 5.34397218,0.670501087 5.38493091,0.677317537 C5.4121544,0.681679446 5.43975838,0.686567734 5.46728143,0.69175063 C5.49097922,0.696416314 5.51402769,0.700988411 5.53702086,0.705767404 C5.64280656,0.727484641 5.74757,0.753856544 5.85081824,0.784467423 C5.86495313,0.788993655 5.87895893,0.793236942 5.89293758,0.797558474 C6.12362285,0.868470682 6.3465321,0.960968522 6.55884724,1.07305189 C6.70723999,1.15174527 6.85059541,1.23968171 6.98792408,1.33674502 C7.22449467,1.50379404 7.44247573,1.69757869 7.63736066,1.91521172 C7.67565379,1.95814783 7.71327231,2.00209958 7.74996282,2.04698065 C7.85240041,2.17230321 7.94524221,2.3013868 8.03033502,2.43676818 C8.04956609,2.4678072 8.06859851,2.49907452 8.08722298,2.53067464 L8.09268977,2.53947801 C8.16033194,2.65489644 8.22246033,2.7746101 8.2786331,2.89835824 C8.30202001,2.9498794 8.31783488,3.00290923 8.32654738,3.0561972 C8.37609004,3.27265752 8.36845944,3.49668979 8.30838876,3.69003893 C8.17426088,4.19301849 7.77777457,4.63834731 7.22014438,4.63834731 C6.84772866,4.63834731 6.54252868,4.43488066 6.18622233,4.0785743 C6.07074179,3.96309376 5.95247848,3.83169009 5.83185446,3.68694126 L5.83185446,3.68694126 L5.674,3.489 L5.36464564,3.7417515 C5.0675081,3.97221952 4.75245776,4.18817949 4.41610529,4.3908989 L4.41610529,4.3908989 L4.07252658,4.58925174 C3.47092521,4.84290111 2.83703048,5.00806456 2.190569,5.08065646 C2.33023852,5.69736953 2.69145736,6.2577154 3.2306752,6.64049928 C4.13150673,7.27998812 5.33631583,7.28702497 6.24455569,6.65810227 C6.52833766,6.4615937 6.91769009,6.53234276 7.11419866,6.81612473 C7.31070724,7.09990671 7.23995818,7.48925913 6.9561762,7.68576771 C5.61543655,8.61418061 3.8369027,8.60379283 2.50709919,7.65978225 C1.38370711,6.86230051 0.783683872,5.54273484 0.886265805,4.20461384 C0.915365388,3.82129311 1.00052362,3.45201765 1.13431225,3.10550223 C1.14302759,3.08395194 1.15149423,3.06255004 1.16014067,3.04124947 C1.17505183,3.0037111 1.1909373,2.96635758 1.20739074,2.92929586 C1.22066426,2.89991568 1.2339882,2.87082507 1.24765163,2.84194317 C1.25524809,2.82554894 1.26309111,2.80929865 1.27104457,2.79310929 L1.30717328,2.72158038 C1.31541191,2.70562433 1.32375609,2.68973673 1.33220483,2.67391839 C1.35089312,2.63894763 1.36991102,2.60466802 1.38943369,2.57070097 C1.39925968,2.55348195 1.40940201,2.53612607 1.41967245,2.51886124 C1.4405235,2.48400288 1.46184054,2.44945257 1.48368569,2.41525675 C1.49955977,2.39015513 1.51573312,2.36545167 1.53217428,2.34095504 C1.5525713,2.31084588 1.57338883,2.28076605 1.59462294,2.25099095 C1.61235609,2.22583621 1.63039873,2.20115969 1.64871916,2.17671549 C1.6672932,2.15221242 1.68602568,2.12782502 1.70504422,2.10366389 C1.72763472,2.07470254 1.75117525,2.04567026 1.77511619,2.017001 C1.79306139,1.99572099 1.81101502,1.97467357 1.82919277,1.95381843 C1.84997682,1.92980992 1.87116785,1.90610772 1.8926389,1.88267811 C1.91473703,1.85866586 1.93734516,1.83459508 1.96026183,1.810811 C1.98296627,1.78720409 2.00587689,1.76403956 2.0290698,1.74117242 C2.05135808,1.71917229 2.07450698,1.69687896 2.09793763,1.67486887 C2.11855841,1.65556735 2.13958472,1.63626225 2.16081917,1.61719312 C2.19268191,1.58845425 2.2248728,1.56046933 2.25753929,1.53300536 C2.27337939,1.51987058 2.28908604,1.50688662 2.30489409,1.49402693 C2.33283931,1.47107492 2.36151267,1.4483943 2.39052293,1.4261087 C2.41525475,1.40735884 2.44001744,1.38881405 2.46500201,1.37056516 C2.49495051,1.34842323 2.52523884,1.32695382 2.55585896,1.3059064 C2.57782355,1.29108457 2.59987441,1.27626043 2.62208055,1.26166093 C2.65456802,1.24002797 2.68756329,1.21904378 2.72090972,1.1985425 C2.74167915,1.18602584 2.76272131,1.17335652 2.78388893,1.16088435 C2.81816375,1.1404669 2.85238442,1.12101805 2.88694397,1.1020721 C2.91061832,1.08927488 2.93467711,1.07639967 2.95888124,1.06377417 C2.98751036,1.0487011 3.01646451,1.03407435 3.04563792,1.01979696 C3.07716745,1.00444426 3.1088867,0.989429985 3.14083038,0.974838877 C3.17045882,0.961301144 3.20004395,0.948257843 3.22983465,0.935569697 C3.26074777,0.922335549 3.29211553,0.909432199 3.32367816,0.896932665 C3.34771577,0.887550084 3.37169835,0.878347709 3.39580378,0.869373355 C3.43408455,0.854915964 3.47285756,0.841147624 3.51189553,0.827985322 C3.53285095,0.821194837 3.55352902,0.814431959 3.57429,0.807835193 C3.62386313,0.791748899 3.67429085,0.776811288 3.72511203,0.762883402 C3.79149779,0.745089784 3.85805408,0.728738166 3.92533957,0.714083481 L3.73609484,0.759890873 C3.79558579,0.743775222 3.85561226,0.729042139 3.91613438,0.715724501 C3.93133095,0.712778565 3.93732268,0.71148829 3.9433147,0.710212634 C3.993365,0.699205376 4.04401978,0.689485 4.09498872,0.680760415 C4.12254877,0.676302349 4.14994535,0.671895291 4.17733689,0.667788072 C4.21441764,0.662040045 4.25210049,0.656978367 4.28993602,0.652462139 C4.31274101,0.64984802 4.33474116,0.647400298 4.3567325,0.645143642 C4.38612171,0.642071168 4.41654975,0.639322904 4.44706724,0.636928482 L4.50517351,0.632791374 C4.52121252,0.631767145 4.53724436,0.630843782 4.55326823,0.630020887 L4.64974813,0.626323405 L4.64974813,0.626323405 Z"></path></g></svg>
    `);
  }
  else if(currentRoute === '/notifications') {
    updateIcon('notifications', `
      <svg width="24px" height="24px" viewBox="0 0 24 24"><g stroke="none" fill="#b92b27" fill-rule="nonzero"><path d="M7.52623147,20.785 L2.79,20.785 C2.44482203,20.785 2.165,20.505178 2.165,20.16 L2.165,17.29 C2.165,17.0074029 2.35462776,16.759965 2.62750674,16.6864928 C3.53489668,16.4421796 4.29934428,15.8306216 4.7207945,15.0318719 C4.9275141,14.5760287 5.06975441,13.9060632 5.14652602,13.0874967 C5.22522536,12.2483761 5.22985909,11.3460973 5.1901543,10.5099262 C5.18132015,10.3238819 5.17258627,10.1897885 5.16500014,10.0695864 C5.16692674,7.15836438 6.9889796,4.66737849 9.56682756,3.68343601 C9.26674573,2.76136733 9.51351889,1.71491397 10.2655534,1.02510085 C11.2368263,0.134188561 12.7281737,0.134188561 13.6994466,1.02510085 C14.4567778,1.71977241 14.7017053,2.77612562 14.3917505,3.70290007 C16.9386536,4.70128291 18.7376316,7.18746315 18.7381538,10.1180033 C18.7329004,10.1862007 18.7247029,10.3170436 18.7164115,10.4987995 C18.678225,11.3358848 18.6837149,12.2411691 18.7623359,13.0834986 C18.8380419,13.8945969 18.9766156,14.5599136 19.17701,15.0156444 C19.6139373,15.8286861 20.3650186,16.4276075 21.2556099,16.6723406 C21.5269485,16.746904 21.715,16.9936028 21.715,17.275 L21.715,20.16 C21.715,20.505178 21.435178,20.785 21.09,20.785 L16.4737685,20.785 C15.6735053,22.5149427 13.9340364,23.6434187 12,23.6434187 C10.0659636,23.6434187 8.3264947,22.5149427 7.52623147,20.785 Z M8.95818095,20.785 C9.63220587,21.774741 10.7627679,22.3934187 12,22.3934187 C13.2372321,22.3934187 14.3677941,21.774741 15.041819,20.785 L8.95818095,20.785 Z M10.7730327,3.3462836 C11.1317244,3.28076521 11.5003399,3.24303757 11.8765942,3.23543396 C11.8774166,3.23540611 11.8782389,3.23537841 11.8790613,3.23535084 L11.9,3.235 L12.0100562,3.23508091 C12.4123669,3.24155487 12.8061097,3.28266789 13.1884584,3.35561277 C13.3719335,2.87349632 13.2526354,2.31147152 12.8544926,1.94627004 C12.3612083,1.49379883 11.6037917,1.49379883 11.1105074,1.94627004 C10.71493,2.30911841 10.5946154,2.86626188 10.7730327,3.3462836 Z"></path></g></svg>
    `);
  }

  userImage.addEventListener('click', () => {
    window.location.href = './profile';
  });

  addQuestionButton.addEventListener('click', (e) => {
    showQuestionFormAndModal(e);
  })

  modal.addEventListener('click', (e) => {
    hideQuestionFormAndModal(e);;
  })

  exitButton.addEventListener('click', (e) => {
    hideQuestionFormAndModal(e);
  });

  cancelButton.addEventListener('click', (e) => {
    hideQuestionFormAndModal(e);
  });

  submitButton.addEventListener('click', async (e) => {
    e.preventDefault();
    const formData = new FormData(questionForm);
    const content = formData.get("content");
    const _csrf = formData.get("_csrf");
    const body = { content, _csrf};

    const res = await fetch('/api/questions', {
      method: "POST",
      body: JSON.stringify(body),
      headers: {
        "Content-Type": "application/json"
      }
    });

    if(res.ok){
      location.reload();
    }
  });
});
